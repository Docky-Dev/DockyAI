<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DockyAI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-default: #334155;
      --border-muted: #1e293b;
      --accent-primary: #3b82f6;
      --accent-hover: #60a5fa;
      --accent-gradient: linear-gradient(135deg, #3b82f6, #6366f1);
      --message-bg: #0f172a;
      --user-message-bg: #1e293b;
      --sidebar-bg: #0f172a;
      --hover-bg: rgba(30, 41, 59, 0.6);
      --glass-bg: rgba(15, 23, 42, 0.8);
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --transition-slow: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
      --transition-medium: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      --transition-fast: all 0.15s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body, html {
      height: 100%;
      width: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    #app {
      height: 100vh;
      width: 100vw;
      display: flex;
      position: relative;
      overflow: hidden;
    }
    
    /* Sidebar - Glassmorphism effect */
    .sidebar {
      width: 280px;
      background: var(--glass-bg);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transform: translateX(0);
      transition: var(--transition-slow);
      z-index: 10;
    }
    
    .sidebar-header {
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 18px;
      color: white;
    }
    
    .logo-icon {
      width: 28px;
      height: 28px;
      background: var(--accent-gradient);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .new-chat-btn {
      background: var(--accent-primary);
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      color: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: var(--transition-medium);
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      box-shadow: var(--shadow-sm);
    }
    
    .new-chat-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    
    .new-chat-btn:active {
      transform: translateY(0);
    }
    
.sidebar-menu .new-chat-btn {
  justify-content: flex-start;
  text-align: left;
  border-radius: 8px;
}

.sidebar-menu .new-chat-btn:hover {
  background: var(--accent-hover);
  color: white;
}
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: var(--transition-medium);
      gap: 12px;
      margin: 4px 12px;
      border-radius: 8px;
    }
    
    .menu-item:hover {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    
    .menu-item.active {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    
    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
      scrollbar-width: thin;
    }
    
    .chat-list-header {
      padding: 8px 24px;
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .chat-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 14px;
      transition: var(--transition-medium);
      position: relative;
      border-radius: 8px;
      margin: 4px 12px;
    }
    
    .chat-item:hover {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    
    .chat-item.active {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    
    .chat-item .chat-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .chat-item .chat-actions {
      opacity: 0;
      display: flex;
      gap: 4px;
      margin-left: 8px;
    }
    
    .chat-item:hover .chat-actions {
      opacity: 1;
    }
    
    .chat-action {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-medium);
    }
    
    .chat-action:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--bg-primary);
  position: relative;
  overflow: hidden;
  height: 100vh; /* Ajoutez cette ligne */
}

    .main-header {
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 5;
    }
    
    .model-selector {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 10px;
      padding: 8px 12px;
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      transition: var(--transition-medium);
    }
    
    .model-selector:hover {
      border-color: var(--accent-primary);
    }
    
    .model-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 10px;
      width: 240px;
      z-index: 100;
      display: none;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      transform: translateY(10px);
      opacity: 0;
      transition: var(--transition-medium);
    }
    
    .model-selector.open .model-dropdown {
      display: block;
      transform: translateY(0);
      opacity: 1;
    }
    
    .model-option {
      padding: 10px 16px;
      cursor: pointer;
      transition: var(--transition-medium);
      font-size: 14px;
    }
    
    .model-option:hover {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    
    .model-option.selected {
      color: var(--accent-primary);
      font-weight: 500;
    }
    
.chat-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  max-width: 800px;
  margin: 0 auto;
  width: 100%;
  padding: 0 24px;
  position: relative;
  z-index: 2;
  height: calc(100% - 120px); /* Ajustez selon vos besoins */
}
    
.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 24px 0;
  scroll-behavior: smooth;
  max-height: calc(100vh - 200px); /* Ajustez cette valeur */
}
    
    /* Welcome screen with animated gradient */
    .welcome-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px 24px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .welcome-title {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #f0f6fc, #c7d2fe);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      position: relative;
    }
    
    .welcome-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--accent-gradient);
      border-radius: 3px;
    }
    
    .welcome-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 32px;
      max-width: 500px;
      line-height: 1.6;
    }
    
    /* Message bubbles with smooth entrance */
    .message-group {
      margin: 24px 0;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .message {
      padding: 12px 0;
      display: flex;
      gap: 16px;
      transition: var(--transition-medium);
    }
    
    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
      transition: var(--transition-medium);
    }
    
    .message.user .message-avatar {
      background: var(--accent-gradient);
      color: white;
      box-shadow: 0 4px 6px rgba(59, 130, 246, 0.2);
    }
    
    .message.assistant .message-avatar {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    .message-content {
      flex: 1;
      line-height: 1.7;
      font-size: 15px;
      padding-top: 6px;
    }
    
    .message.user .message-content {
      color: var(--text-primary);
    }
    
    .message.assistant .message-content {
      color: var(--text-primary);
    }
    
.input-area {
  padding: 16px 24px;
  background: rgba(15, 23, 42, 0.9);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  position: sticky;
  bottom: 0;
  z-index: 5;
  width: 100%;
}

  .input-container {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
  }

  .input-wrapper {
    display: flex;
    align-items: center;
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid rgba(74, 85, 104, 0.3);
    border-radius: 16px;
    min-height: 56px;
    padding: 8px 16px;
    transition: var(--transition-medium);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
  }

  .input-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.3), transparent);
  }

  .input-wrapper:focus-within {
    border-color: rgba(59, 130, 246, 0.5);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 16px rgba(59, 130, 246, 0.2);
    transform: translateY(-2px);
  }

  #message-input {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 15px;
    line-height: 1.6;
    resize: none;
    outline: none;
    min-height: 24px;
    max-height: 200px;
    overflow-y: auto;
    font-family: inherit;
    padding: 8px 12px 8px 0;
    margin: 0;
    scrollbar-width: thin;
  }

  #message-input::placeholder {
    color: var(--text-muted);
    opacity: 0.7;
  }

  .send-button {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: var(--accent-gradient);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    transition: var(--transition-medium);
    flex-shrink: 0;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.25);
  }

  .send-button:hover:not(:disabled) {
    background: var(--accent-hover);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 12px rgba(59, 130, 246, 0.3);
  }

  .send-button:active:not(:disabled) {
    transform: translateY(0) scale(0.98);
  }

  .send-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--bg-tertiary);
    box-shadow: none;
  }
    
    .send-button:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(59, 130, 246, 0.3);
    }
    
    .send-button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--bg-tertiary);
    }
    
    /* Typing indicator with smooth animation */
    .typing-indicator {
      display: none;
      padding: 16px 0;
      color: var(--text-secondary);
      font-style: italic;
      display: flex;
      align-items: center;
      gap: 12px;
      opacity: 0;
      transition: var(--transition-medium);
    }
    
    .typing-indicator.active {
      opacity: 1;
    }
    
    .typing-dots {
      display: flex;
      gap: 6px;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--text-secondary);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
      transform: translateY(0);
    }
    
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    /* Floating background elements */
    .floating-shapes {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
      pointer-events: none;
    }
    
    .shape {
      position: absolute;
      opacity: 0.05;
      border-radius: 50%;
      filter: blur(40px);
      animation: float 15s infinite ease-in-out;
    }
    
    .shape-1 {
      width: 300px;
      height: 300px;
      background: var(--accent-primary);
      top: 20%;
      left: 10%;
      animation-delay: 0s;
    }
    
    .shape-2 {
      width: 400px;
      height: 400px;
      background: #6366f1;
      bottom: 10%;
      right: 10%;
      animation-delay: 3s;
    }
    
    .shape-3 {
      width: 200px;
      height: 200px;
      background: #60a5fa;
      top: 50%;
      right: 20%;
      animation-delay: 6s;
    }
    
    /* Animations */
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes float {
      0%, 100% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(20px, 20px) rotate(5deg);
      }
      50% {
        transform: translate(0, 40px) rotate(0deg);
      }
      75% {
        transform: translate(-20px, 20px) rotate(-5deg);
      }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100%;
        z-index: 100;
        transition: var(--transition-slow);
      }
      
      .sidebar.open {
        left: 0;
      }
      
      .main-content {
        width: 100%;
      }
      
      .chat-area {
        max-width: 100%;
        padding: 0 16px;
      }
      
      .messages-container {
        padding: 16px 0;
      }
      
      .input-area {
        padding: 16px;
      }
      
      .welcome-title {
        font-size: 28px;
      }
    }
    
    /* Mobile menu toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent-gradient);
      color: white;
      border: none;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      transition: var(--transition-medium);
    }
    
    .mobile-menu-toggle:hover {
      transform: translateY(-3px) scale(1.05);
    }
    
    .mobile-menu-toggle:active {
      transform: translateY(0);
    }
    
    @media (max-width: 768px) {
      .mobile-menu-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
    
    /* Loading animation */
    @keyframes pulse {
      0%, 100% {
        opacity: 0.5;
      }
      50% {
        opacity: 1;
      }
    }
    
    .loading {
      animation: pulse 1.5s infinite ease-in-out;
    }

      .voice-button {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 8px;
    transition: var(--transition-medium);
  }

  .voice-button:hover {
    background: rgba(59, 130, 246, 0.1);
    color: var(--accent-primary);
  }

  .sidebar-menu {
  display: flex;
  flex-direction: column;
  align-items: center;
  /* Optional: add padding-top for spacing */
  padding-top: 12px;
}

.sidebar-menu .new-chat-btn {
  width: 90%;
  border-radius: 15px;
  font-weight: 600;
  margin: 4px 0;
  /* Remove position: center !important; and background: var(--primary); */
  /* Center text inside button */
  justify-content: center;
}

  .sidebar-menu .menu-item {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 14px;
    font-weight: 500;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-medium);
    text-align: left;
    margin: 4px 0;
  }
  .sidebar-menu .menu-item:hover {
    background: var(--accent-hover);
    color: white;
  }
  .sidebar-menu .menu-item:active {
    background: var(--accent-primary);
    color: white;
  }
  .sidebar-menu .menu-item:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--bg-tertiary);
    color: var(--text-muted);
  }
  .sidebar-menu .new-chat-btn {
    /* retire le style spécifique, hérite de .menu-item */
    position: center !important;
    background: var(--primary);
    color: white;
    margin: 4px 0;
    width: 90%;
    border-radius: 15px;
    font-weight: 600;
  }
  .sidebar-menu .new-chat-btn:hover {
    color: white;
  }
  .sidebar-menu .new-chat-btn:active {
    color: white;
  }
  </style>
</head>
<body>
  <!-- Floating background shapes -->
  <div class="floating-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>
  
  <div id="app">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
          </div>
          DockyAI
        </div>
      </div>

<div class="sidebar-menu">
  <button class="new-chat-btn menu-item" id="new-chat-btn">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
    </svg>
    New chat
  </button>
</div>
      
      <div class="chat-list">
        <div id="chat-list"></div>
      </div>
    </div>
    
    <div class="main-content">
      <div class="main-header">
        <div class="model-selector" id="model-selector">
          <span id="current-model">DockyAI 3i</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6"/>
          </svg>
          <div class="model-dropdown" id="model-dropdown">
            <!-- Model options will be added here dynamically -->
          </div>
        </div>
      </div>
      
      <div class="chat-area">
        <div class="messages-container" id="messages-container">
          <div class="welcome-screen" id="welcome-screen">
            <div class="welcome-title">How can I help you today?</div>
            <div class="welcome-subtitle">
              I'm DockyAI, your AI assistant. Ask me anything and I'll do my best to help you.
            </div>
          </div>
        </div>
        
        <div class="typing-indicator" id="typing-indicator">
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
          <span>DockyAI is typing...</span>
        </div>
      </div>
      
      <div class="input-area">
        <div class="input-container">
          <div class="input-wrapper">
            <textarea 
              id="message-input" 
              placeholder="Message DockyAI..." 
              rows="1"
            ></textarea>
            <button class="send-button" id="send-button" disabled>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12h18M3 6h18M3 18h18"/>
      </svg>
    </button>
  </div>

  <script>
    const apiKey = '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';
    const apiUrl = 'https://openrouter.ai/api/v1/chat/completions';
    
    // Available models
    const MODELS = {
      "DockyAI 3i": "openai/gpt-oss-20b:free",
      "DockyAI 2.1": "google/gemini-2.5-flash-lite-preview-06-17",
      "OpenAI: gpt-oss-20b": "openai/gpt-oss-20b:free",
      "DeepSeek: DeepSeek V3 0324": "deepseek/deepseek-chat-v3-0324:free",
      "Cypher Alpha": "openrouter/cypher-alpha:free",
      "Mistral: Mistral Small 3.2 24B": "mistralai/mistral-small-3.2-24b-instruct:free",
      "Kimi Dev 72b": "moonshotai/kimi-dev-72b:free",
      "Deepseek R1 0528 Qwen3 8B": "deepseek/deepseek-r1-0528-qwen3-8b:free",
      "DeepSeek: R1 0528": "deepseek/deepseek-r1-0528:free",
      "Sarvam AI Sarvam-M": "sarvamai/sarvam-m:free",
      "Mistral: Devstral Small": "mistralai/devstral-small:free",
      "Google: Gemma 3n 4B": "google/gemma-3n-e4b-it:free",
      "Qwen: Qwen3 30B A3B": "qwen/qwen3-30b-a3b:free",
      "Qwen: Qwen3 8B": "qwen/qwen3-8b:free",
      "Microsoft: MAI DS R1": "microsoft/mai-ds-r1:free",
      "Shisa AI: Shisa V2 Llama 3.3 70B": "shisa-ai/shisa-v2-llama-3.3-70b:free",
      "ArliAI: QwQ 32B RpR v1": "arliai/qwq-32b-arliai-rpr-v1:free",
      "Agentica: Deepcoder 14B Preview": "agentica-org/deepcoder-14b-preview:free",
      "Moonshot AI: Kimi VL A3B Thinking": "moonshotai/kimi-vl-a3b-thinking:free",
      "Meta: Llama 4 Maverick 8B": "meta-llama/llama-4-maverick:free",
      "Meta: Llama 4 Scout 8B": "meta-llama/llama-4-scout:free",
      "Qwerky 72B": "featherless/qwerky-72b:free",
      "Reka: Flash 3": "rekaai/reka-flash-3:free",
      "Nous: DeepHermes 3 Llama 3 8B Preview": "nousresearch/deephermes-3-llama-3-8b-preview:free",
      "Dolphin3.0 R1 Mistral 24B": "cognitivecomputations/dolphin3.0-r1-mistral-24b:free",
      "MoonshotAI: Kimi K2": "moonshotai/kimi-k2:free",
      "Venice: Uncensored": "cognitivecomputations/dolphin-mistral-24b-venice-edition:free",
    };
    
    let conversations = {};
    let currentConversationId = null;
    
    // Initialize app
    function init() {
      loadConversations();
      setupEventListeners();
      renderChatList();
      renderModelDropdown();
      
      if (currentConversationId) {
        renderMessages();
        updateUI();
      }
    }
    
    function setupEventListeners() {
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      const newChatBtn = document.getElementById('new-chat-btn');
      const modelSelector = document.getElementById('model-selector');
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      
      if (messageInput) messageInput.addEventListener('input', handleInputChange);
      if (messageInput) messageInput.addEventListener('keypress', handleKeyPress);
      if (sendButton) sendButton.addEventListener('click', sendMessage);
      if (newChatBtn) newChatBtn.addEventListener('click', createNewChat);
      if (modelSelector) modelSelector.addEventListener('click', toggleModelDropdown);
      if (mobileMenuToggle) mobileMenuToggle.addEventListener('click', toggleMobileMenu);
      
      // Auto-resize textarea
      if (messageInput) messageInput.addEventListener('input', autoResizeTextarea);
      
      // Close model dropdown when clicking outside
      document.addEventListener('click', (e) => {
        const modelSelector = document.getElementById('model-selector');
        if (modelSelector && !modelSelector.contains(e.target)) {
          modelSelector.classList.remove('open');
        }
      });
    }
    
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar) sidebar.classList.toggle('open');
    }
    
    function renderModelDropdown() {
      const dropdown = document.getElementById('model-dropdown');
      if (!dropdown) return;
      
      dropdown.innerHTML = '';
      
      Object.keys(MODELS).forEach(modelName => {
        const option = document.createElement('div');
        option.className = 'model-option';
        option.textContent = modelName;
        
        // Mark selected model
        if (currentConversationId && 
            conversations[currentConversationId].model === MODELS[modelName]) {
          option.classList.add('selected');
        }
        
        option.addEventListener('click', () => {
          changeModel(MODELS[modelName]);
          const modelSelector = document.getElementById('model-selector');
          if (modelSelector) modelSelector.classList.remove('open');
        });
        dropdown.appendChild(option);
      });
    }
    
    function toggleModelDropdown() {
      this.classList.toggle('open');
    }
    
    function changeModel(modelId) {
      if (!currentConversationId) return;
      
      conversations[currentConversationId].model = modelId;
      saveConversations();
      updateUI();
      
      // Update current model display
      const modelName = Object.keys(MODELS).find(key => MODELS[key] === modelId) || "DockyAI 3i";
      const currentModelElement = document.getElementById('current-model');
      if (currentModelElement) currentModelElement.textContent = modelName;
      
      // Re-render dropdown to update selected state
      renderModelDropdown();
    }
    
    function autoResizeTextarea() {
      const textarea = document.getElementById('message-input');
      if (!textarea) return;
      
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
    }
    
    function handleInputChange() {
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      
      if (messageInput && sendButton) {
        sendButton.disabled = !messageInput.value.trim();
      }
    }
    
    function handleKeyPress(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }
    
    function loadConversations() {
      const saved = localStorage.getItem('docky-conversations');
      if (saved) {
        conversations = JSON.parse(saved);
        
        // Find active conversation or use the first one
        const activeConv = Object.values(conversations).find(conv => conv.active);
        if (activeConv) {
          currentConversationId = activeConv.id;
        } else if (Object.keys(conversations).length > 0) {
          currentConversationId = Object.keys(conversations)[0];
          conversations[currentConversationId].active = true;
        }
      }
      
      // Create default conversation if none exists
      if (Object.keys(conversations).length === 0) {
        createNewChat(false);
      }
    }
    
    function saveConversations() {
      localStorage.setItem('docky-conversations', JSON.stringify(conversations));
    }
    
    function createNewChat(switchTo = true) {
      const id = 'chat-' + Date.now();
      const name = `Chat ${Object.keys(conversations).length + 1}`;
      
      conversations[id] = {
        id,
        name: "New Chat",
        model: "openai/gpt-oss-20b:free",
        messages: [],
        active: false,
        createdAt: new Date().toISOString()
      };
      
      if (switchTo) {
        // Deactivate all conversations
        Object.values(conversations).forEach(conv => conv.active = false);
        
        // Activate new conversation
        conversations[id].active = true;
        currentConversationId = id;
        
        renderMessages();
        updateUI();
      }
      
      if (!currentConversationId) {
        currentConversationId = id;
        conversations[id].active = true;
      }
      
      saveConversations();
      renderChatList();
      
      // Close mobile menu if open
      const sidebar = document.getElementById('sidebar');
      if (sidebar) sidebar.classList.remove('open');
    }
    
    function switchToChat(id) {
      // Deactivate all conversations
      Object.values(conversations).forEach(conv => conv.active = false);
      
      // Activate selected conversation
      conversations[id].active = true;
      currentConversationId = id;
      
      renderMessages();
      updateUI();
      saveConversations();
      renderChatList();
      
      // Close mobile menu if open
      const sidebar = document.getElementById('sidebar');
      if (sidebar) sidebar.classList.remove('open');
    }
    
    function deleteChat(id) {
      if (Object.keys(conversations).length <= 1) {
        alert("You can't delete the last conversation.");
        return;
      }
      
      delete conversations[id];
      
      if (id === currentConversationId) {
        // Switch to first available conversation
        currentConversationId = Object.keys(conversations)[0];
        conversations[currentConversationId].active = true;
        renderMessages();
        updateUI();
      }
      
      saveConversations();
      renderChatList();
    }
    
    function renderChatList() {
      const chatList = document.getElementById('chat-list');
      if (!chatList) return;
      
      chatList.innerHTML = '';
      
      // Group conversations by date
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      const todayConvs = [];
      const yesterdayConvs = [];
      const olderConvs = [];
      
      Object.values(conversations).forEach(conv => {
        const convDate = new Date(conv.createdAt).toDateString();
        if (convDate === today) {
          todayConvs.push(conv);
        } else if (convDate === yesterday) {
          yesterdayConvs.push(conv);
        } else {
          olderConvs.push(conv);
        }
      });
      
      // Render today's conversations
      if (todayConvs.length > 0) {
        const header = document.createElement('div');
        header.className = 'chat-list-header';
        header.textContent = 'Today';
        chatList.appendChild(header);
        
        todayConvs
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .forEach(conv => renderChatItem(conv, chatList));
      }
      
      // Render yesterday's conversations
      if (yesterdayConvs.length > 0) {
        const header = document.createElement('div');
        header.className = 'chat-list-header';
        header.textContent = 'Yesterday';
        chatList.appendChild(header);
        
        yesterdayConvs
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .forEach(conv => renderChatItem(conv, chatList));
      }
      
      // Render older conversations
      if (olderConvs.length > 0) {
        const header = document.createElement('div');
        header.className = 'chat-list-header';
        header.textContent = 'Older';
        chatList.appendChild(header);
        
        olderConvs
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .forEach(conv => renderChatItem(conv, chatList));
      }
    }
    
    function renderChatItem(conv, parent) {
      const chatItem = document.createElement('div');
      chatItem.className = `chat-item ${conv.active ? 'active' : ''}`;
      chatItem.innerHTML = `
        <span class="chat-name">${conv.name}</span>
        <div class="chat-actions">
          <button class="chat-action" onclick="deleteChat('${conv.id}')" title="Delete">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
            </svg>
          </button>
        </div>
      `;
      
      chatItem.addEventListener('click', (e) => {
        if (!e.target.closest('.chat-actions')) {
          switchToChat(conv.id);
        }
      });
      
      parent.appendChild(chatItem);
    }
    
    function renderMessages() {
      const messagesContainer = document.getElementById('messages-container');
      if (!messagesContainer) return;
      
      const currentConv = conversations[currentConversationId];
      
      // Clear the container first
      messagesContainer.innerHTML = '';
      
      if (!currentConv || currentConv.messages.length === 0) {
        // Create welcome screen if no messages
        const welcomeDiv = document.createElement('div');
        welcomeDiv.id = 'welcome-screen';
        welcomeDiv.className = 'welcome-screen';
        welcomeDiv.innerHTML = `
          <div class="welcome-title">How can I help you today?</div>
          <div class="welcome-subtitle">
            I'm DockyAI, your AI assistant. Ask me anything and I'll do my best to help you.
          </div>
        `;
        messagesContainer.appendChild(welcomeDiv);
        return;
      }
      
      currentConv.messages.forEach((message, index) => {
        // Add slight delay between messages for staggered animation
        setTimeout(() => {
          addMessageToUI(message);
        }, index * 50);
      });
      
      scrollToBottom();
    }
    
    function addMessageToUI(message) {
      const messagesContainer = document.getElementById('messages-container');
      if (!messagesContainer) return;
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${message.role}`;
      
      const avatar = message.role === 'user' ? 'Me' : 'AI';
      const content = message.content.replace(/\n/g, '<br>');
      
      messageDiv.innerHTML = `
        <div class="message-avatar">${avatar}</div>
        <div class="message-content">${content}</div>
      `;
      
      // Add animation class
      messageDiv.style.opacity = '0';
      messageDiv.style.transform = 'translateY(10px)';
      messageDiv.style.animation = 'fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards';
      
      messagesContainer.appendChild(messageDiv);
      scrollToBottom();
    }
    
    function updateUI() {
      const currentConv = conversations[currentConversationId];
      if (currentConv) {
        const modelName = Object.keys(MODELS).find(key => MODELS[key] === currentConv.model) || "DockyAI 3i";
        const currentModelElement = document.getElementById('current-model');
        if (currentModelElement) currentModelElement.textContent = modelName;
      }
    }
    
    async function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      const typingIndicator = document.getElementById('typing-indicator');
      
      if (!messageInput || !sendButton || !typingIndicator) return;
      
      const message = messageInput.value.trim();
      if (!message) return;
      
      const currentConv = conversations[currentConversationId];
      if (!currentConv) return;
      
      // Add user message
      const userMessage = { role: 'user', content: message };
      currentConv.messages.push(userMessage);
      addMessageToUI(userMessage);
      
      // Clear input and disable send button
      messageInput.value = '';
      messageInput.style.height = 'auto';
      sendButton.disabled = true;
      
      // Show typing indicator
      typingIndicator.classList.add('active');
      scrollToBottom();
      
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json',
            'HTTP-Referer': window.location.href,
            'X-Title': 'DockyAI'
          },
          body: JSON.stringify({
            model: currentConv.model,
            messages: currentConv.messages
          })
        });
        
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.choices || !data.choices[0]) {
          throw new Error('Invalid response format from API');
        }
        
        const assistantMessage = {
          role: 'assistant',
          content: data.choices[0].message?.content || "Sorry, I couldn't generate a response."
        };
        
        currentConv.messages.push(assistantMessage);
        addMessageToUI(assistantMessage);
        
        // Update conversation name if this is the first message
        if (currentConv.messages.length === 2) {
          currentConv.name = message.slice(0, 30) + (message.length > 30 ? '...' : '');
          renderChatList();
        }
        
      } catch (error) {
        console.error('Error:', error);
        const errorMessage = {
          role: 'assistant',
          content: 'Sorry, there was an error processing your request. Please try again.'
        };
        currentConv.messages.push(errorMessage);
        addMessageToUI(errorMessage);
      } finally {
        typingIndicator.classList.remove('active');
        scrollToBottom();
        saveConversations();
      }
    }
    
    function scrollToBottom() {
      const messagesContainer = document.getElementById('messages-container');
      if (!messagesContainer) return;
      
      // Use smooth scrolling if available
      if ('scrollBehavior' in document.documentElement.style) {
        messagesContainer.scrollTo({
          top: messagesContainer.scrollHeight,
          behavior: 'smooth'
        });
      } else {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
    }
    
    // Expose functions to global scope for HTML onclick
    window.deleteChat = deleteChat;
    
    window.addEventListener('DOMContentLoaded', () => {
      init();
      
      // Animate welcome screen after DOM is fully loaded
      const welcomeScreen = document.getElementById('welcome-screen');
      if (welcomeScreen) {
        welcomeScreen.style.display = 'flex';
      }
    });
  </script>
</body>
</html>
